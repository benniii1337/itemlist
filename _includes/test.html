{%- assign Fabrics = '' | split: ',' -%}
{%- assign Leathers = '' | split: ',' -%}
{%- assign Metals = '' | split: ',' -%}
{%- assign Stone = '' | split: ',' -%}
{%- assign type = include.type -%}

{%- assign count = 0 -%}

{%- for item in site.data.StoreItems.items -%}
    {%- if item.category == "Textiles" -%}
        {%- assign Fabrics = Fabrics | push: item | sort: "abr" -%}
        {%- continue -%}
    {%- endif -%}
    
    {%- if item.category == "Wools" -%}
        {%- assign Fabrics = Fabrics | push: item | sort: "abr" -%}
        {%- continue -%}
    {%- endif -%}
    
    {%- if item.category == "Leathers" -%}
        {%- assign Leathers = Leathers | push: item | sort: "abr" -%}
        {%- continue -%}
    {%- endif -%}
    
    {%- if item.category == "Stone blocks" -%}
        {%- assign Stone = Stone | push: item | sort: "abr" -%}
        {%- continue -%}
    {%- endif -%}
    
    {%- if item.category == "Raw resources" -%}
        {%- if item.abr == "wood" -%}
          {%- continue -%}
        {%- elsif item.abr == "jade" -%}
          {%- assign Stone = Stone | push: item | sort: "abr" -%}
          {%- continue -%}
        {% else %}
          {%- assign Metals = Metals | push: item | sort: "abr" -%}
          {%- continue -%}
        {%- endif -%}
    {%- endif -%}
{%- endfor -%}

{% comment %}
Fabric = Fabrics (Textiles + Wools)
Leathery = Leathers
Stony = Stone (+ Jade)
Metallic = Metals (Raw resources)
Woody = Wood
{% endcomment %}

WORK IN PROGRESS
<div class="box">
  <div class="drops">
    <select id="select_apparel" style="width: 100%">
      <option value="" data-placeholder>Apparel</option>
        {%- for item in include.displayData -%}
          {%- if type == "Apparel" -%}
            <option data-cat="{{- item.ingredients -}}" value="{{- item.abr -}}">{{- item.abr | capitalize -}}</option>
            {%- continue -%}
          {%- endif -%}
        {%- endfor -%}
    </select>
  </div>
  <div class="drops">
    <select id="select_material" style="width: 100%">
      <option value="" data-placeholder>Material</option>
      <optgroup id="fabric" label="Fabrics">
        {%- for item in Fabrics -%}
          <option value="{{- item.abr -}}">{{- item.abr | capitalize -}}</option>
          {%- continue -%}
        {%- endfor -%}
      </optgroup>
      <optgroup id="leathery" label="Leathers">
        {%- for item in Leathers -%}
          <option value="{{- item.abr -}}">{{- item.abr | capitalize -}}</option>
          {%- continue -%}
        {%- endfor -%}
      </optgroup>
      <optgroup id="stony" label="Stone">
        {%- for item in Stone -%}
          <option value="{{- item.abr -}}">{{- item.abr | capitalize -}}</option>
          {%- continue -%}
        {%- endfor -%}
      </optgroup>
      <optgroup id="metallic" label="Metals">
        {%- for item in Metals -%}
          <option value="{{- item.abr -}}">{{- item.abr | capitalize -}}</option>
          {%- continue -%}
        {%- endfor -%}
      </optgroup>
      <optgroup id="woody" label="Wood">
          <option value="wood">Wood</option>
      </optgroup>
    </select>
  </div>
  <div class="drops">
    <select id="select_quality" style="width: 100%">
      <option value="" data-placeholder>Quality</option>
      <option value="awful">Awful</option>
      <option value="poor">Poor</option>
      <option value="normal">Normal</option>
      <option value="good">Good</option>
      <option value="excellent">Excellent</option>
      <option value="masterwork">Masterwork</option>
      <option value="legendary">Legendary</option>
    </select>
  </div>
  <div class="copy">
    <input type="textbox" value="" class= "inoutput" id="output" style="width: 350px"/> 
  </div>
  <div class="copy">
    <button onclick="copyOutput()">COPY TO CLIPBOARD</button>
  </div>
</div>

<script>

  easydropdown('#select_apparel', {
    behavior: {
      liveUpdates: true,
      showPlaceholderWhenOpen: true
    },
    callbacks: {
      onSelect: function() {
      	var val = $('#select_apparel').find(':selected').data('cat');
        val = val.split(", ");
				val = val.map(function(elem) { return elem.toLowerCase(); }); 
				$("#select_material")[0].selectedIndex = 0;
				document.querySelectorAll("#select_material optgroup").forEach(opt => {
          if ($.inArray(opt.id, val) != -1) {
            opt.disabled = false; 
          } else {
          	opt.disabled = true;
          }
				});
      },
    }
  });
  
  easydropdown('#select_material', {
    behavior: {
      liveUpdates: true,
      showPlaceholderWhenOpen: true
    }
  });
  
  easydropdown('#select_quality', {
    behavior: {
      liveUpdates: true,
      showPlaceholderWhenOpen: true
    }
  });
  
</script>
